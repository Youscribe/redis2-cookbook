# Generated by Chef
# host definitions
<% monitor_cloud_provider = begin; node.cloud.provider; rescue; "none"; end %>
<% @nodes.each do |n| %>
define host {
  <% if not n.attribute? :cloud %>
  use server
  address <%= n['ipaddress'] %>
  <% else %>
  use <%=n[:cloud].provider%>-host
    <% if monitor_cloud_provider != n[:cloud].provider %>
  address <%= n['cloud']['public_ips'].first %>
    <% else %>
  address <%= n['ipaddress'] %>
    <% end %>
  <% end %>
  host_name <%= n['hostname'] || n['fqdn'] || n.name %>
  <% if n.roles.any? %>
   hostgroups <%= n.roles.to_a.join(",") %><%= ",#{n[:cloud].provider}" if n.attribute?(:cloud) ? n[:cloud].attribute?(:provider) : false %>
  <% end %>
}

<% end %>

define host {
  use router
  host_name default-gw
  address <%= @default_gw ? @default_gw : node[:ipaddress] %>
  hostgroups routers
}
